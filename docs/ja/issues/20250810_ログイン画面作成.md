## セッション用の状態管理の構造体を定義
- [x] 完了フラグ
### 構造体「認証」
- jwt: 認証トークン
- 家族メンバータイプ: 家族メンバータイプEnumの値

#### 作成したドキュメント
- [セッション_認証構造体.md](../requirements/shared/セッション_認証構造体.md)
- [セッション_認証状態管理.md](../requirements/shared/セッション_認証状態管理.md)


## セッション用の状態管理と構造体を作成
- [x] 完了フラグ
### 配置場所
- 構造体: `/packages/frontend/src/features/session/structure/session.ts`
- 状態: `/packages/frontend/src/features/session/store/sessionStore.ts`

### 使用ライブラリ
- Zustand: 状態管理ライブラリ

### 作成したファイル
- `/packages/frontend/src/features/session/structure/session.ts`: 認証情報とセッション全体の型定義
- `/packages/frontend/src/features/session/store/sessionStore.ts`: Zustandを使った状態管理ストア
- `/packages/frontend/src/features/session/index.ts`: セッション機能のエクスポート


## ログインtRPCの実装
### バックエンド_クエリサービスの修正
- [x] 完了フラグ
#### 配置場所
- `packages/backend/src/features/auth/query/loginQuery.ts`

#### 追加内容
- ユーザIDを元に家族名も取得するように修正

#### 修正内容
- FamilyEntityのインポートを追加
- LoginQueryResultインターフェースにfamilyNameフィールドを追加
- SQLクエリでFamilyEntityをJOINして家族名を取得
- 戻り値にfamilyNameを含めるように修正

### tRPCの修正
- [x] 完了フラグ
#### 配置場所
- `packages/backend/src/features/auth/router/loginRouter.ts`

#### 追加内容
- ログイン時に家族名も返すように修正
- `loginQuery`を呼び出して家族名を取得し、レスポンスに追加

#### 修正内容
- LoginResponseクラスにfamilyNameフィールドを追加
- fromQueryResultメソッドを修正してfamilyNameを含めるように更新

## ログイン画面に関連する値オブジェクトの作成
- [x] 完了フラグ
### 配置場所
- `/packages/shared/features/auth/value-object/`
  - email: Email値オブジェクトを作成（メールアドレスの検証機能付き）
  - password: Password値オブジェクトを作成（英数字必須、8-128文字制限）
- `/packages/shared/features/family/value-object/`
  - familyName: FamilyName値オブジェクトを作成（1-20文字制限）

### 作成したファイル
- `/packages/shared/features/auth/value-object/email.ts`: メールアドレス値オブジェクト
- `/packages/shared/features/auth/value-object/password.ts`: パスワード値オブジェクト
- `/packages/shared/features/family/value-object/familyName.ts`: 家族名値オブジェクト
- `/packages/shared/features/auth/index.ts`: Auth機能のエクスポート
- `/packages/shared/features/family/index.ts`: Family機能のエクスポート

## ログイン画面の状態・構造体作成
- [x] 完了フラグ
### 配置場所
- ログインフォーム構造体: `/packages/frontend/src/features/login/structure/loginForm.ts`
- 家族選択ダイアログ構造体: `/packages/frontend/src/features/login/structure/selectFamilyDialog.ts`
- 状態管理: `/packages/frontend/src/features/login/store/loginPageStore.ts`
- ヘルパーフック: `/packages/frontend/src/features/login/hooks/loginPageHooks.ts`

### 使用ライブラリ
- Zustand: 状態管理ライブラリ（devtools middleware付き）

### 作成したファイル
- `/packages/frontend/src/features/login/structure/loginForm.ts`: LoginFormクラス（isValidメソッド付き）
- `/packages/frontend/src/features/login/structure/selectFamilyDialog.ts`: SelectFamilyDialogクラス（メソッド付き）
- `/packages/frontend/src/features/login/store/loginPageStore.ts`: Zustand状態管理ストア（isValid状態付き）
- `/packages/frontend/src/features/login/hooks/loginPageHooks.ts`: セレクター・アクションフック
- `/packages/frontend/src/features/login/index.ts`: Login機能のエクスポート

### 実装内容
#### 構造体クラス
- **LoginForm**: isValid()メソッドでメール・パスワード検証
- **SelectFamilyDialog**: hasSelectedFamily()等のメソッド付き
- 各クラスに安全作成メソッド（createSafely）と初期値作成メソッド

#### 状態管理
- **isValid**: フォーム全体の有効性を自動計算
- **isLoading**: ローディング状態
- **isDialogVisible**: ダイアログ表示状態  
- **loginForm**: 生のフォームデータ
- **selectFamilyDialog**: 家族選択ダイアログデータ
- フォーム更新時に自動でisValidを再計算

#### ヘルパーフック
- フォーム値オブジェクト取得
- バリデーション状態取得
- 各種セレクター・アクションフック

## フロントエンドのログインユースケース作成
- [x] 完了フラグ

### 配置場所
- `/packages/frontend/src/features/login/usecase/login.ts`
- メソッド名: `login`
- 引数: params { jwtToken: string }

### 処理内容
- JWTトークンを含めた動的tRPCクライアントを作成
- tRPCを使ってログインAPIを呼び出しレスポンスを取得
- 取得した情報で状態更新
  - セッションストアの更新（認証情報）
  - ログイン画面状態の更新（ローディング状態）

### 実装内容
- **引数**: LoginUsecaseParams { jwtToken: string }
- **戻り値**: LoginUsecaseResult { success: boolean, errorMessage?: string, userInfo?: object }
- **エラーハンドリング**: try-catchでエラーをキャッチし、適切なメッセージを返却
- **状態管理連携**: useLoginPageStore、useSessionStoreと連携
- **tRPC呼び出し**: 動的にヘッダー（Authorization、languageid）を設定したクライアントを作成
- **家族メンバータイプ判定**: レスポンスのparentId/childIdから適切なタイプを設定

### 作成したファイル
- `/packages/frontend/src/features/login/usecase/login.ts`: ログインユースケース実装
- `/packages/frontend/src/features/login/index.ts`: エクスポートに追加


## ログイン画面のコンポーネント作成
- [x] 完了フラグ
### 配置場所
- `/packages/frontend/src/features/login/components/`

### 作成したコンポーネント
#### 基本コンポーネント
- `AppTitleLabel.tsx`: アプリタイトル表示ラベル
- `AppIcon.tsx`: クリップボードアイコン表示コンポーネント

#### フォームコンポーネント
- `EmailInputField.tsx`: メールアドレス入力フィールド（バリデーション・エラー表示付き）
- `PasswordInputField.tsx`: パスワード入力フィールド（マスク表示・表示切り替え機能付き）

#### ボタンコンポーネント
- `LoginButton.tsx`: ログインボタン（ローディング・無効状態対応）
- `CreateFamilyButton.tsx`: 新規家族作成ボタン
- `ParentLoginButton.tsx`: 親ログインボタン（アイコン付き）
- `ChildLoginButton.tsx`: 子供ログインボタン（アイコン付き）
- `CancelButton.tsx`: キャンセルボタン

#### リンクコンポーネント
- `ForgotPasswordLink.tsx`: パスワード忘れリンク
- `TermsOfServiceLink.tsx`: 利用規約リンク

#### ダイアログコンポーネント
- `SelectFamilyDialog.tsx`: 家族選択モーダルダイアログ（親・子ログインボタン含む）

#### メイン画面コンポーネント
- `LoginScreen.tsx`: ログイン画面全体の統合コンポーネント（状態管理連携済み）

### 実装内容
- **React Native**: Expo環境向けの実装
- **状態管理連携**: Zustandストアとの完全連携
- **TypeScript**: 厳密な型定義とprops設計
- **バリデーション**: リアルタイムフォーム検証
- **アクセシビリティ**: KeyboardAvoidingView等の実装
- **レスポンシブデザイン**: 画面サイズ対応レイアウト
- **エラーハンドリング**: 適切なエラー表示機能

### 作成したファイル
- `/packages/frontend/src/features/login/components/index.ts`: 全コンポーネントのエクスポート
- `/packages/frontend/src/features/login/index.ts`: メインエクスポートへの追加（名前競合解決済み）

### 使用ライブラリ
- React Native Elements
- Expo Vector Icons (Ionicons)
- React Native Modal


## ログイン画面の作成
- [x] 完了フラグ

### 配置場所
- `/packages/frontend/src/features/login/pages/LoginPage.tsx`

### 実装内容
#### ページ機能
- **統合ログインページ**: LoginScreenコンポーネントを使用したメインページ
- **イベントハンドリング**: 設計書通りのメソッド実装
- **状態管理連携**: Zustandストアとの完全連携
- **セッション管理**: JWTトークンの設定・管理
- **エラーハンドリング**: 適切なアラート表示
- **画面遷移**: TODO実装（React Navigation対応待ち）

#### 実装メソッド
- `handleLogin()`: Supabase認証処理（mockで実装、TODO: 実装）
- `handleCreateFamily()`: 新規家族作成画面への遷移（TODO: 実装）
- `handleForgotPassword()`: パスワードリセット画面への遷移（TODO: 実装）
- `handleParentLogin()`: 親としてのログイン処理
- `handleChildLogin()`: 子供としてのログイン処理
- `handleTermsOfService()`: 利用規約画面への遷移（TODO: 実装）
- `handleCloseDialog()`: 家族選択ダイアログを閉じる処理

#### テーマ対応
- **ダークテーマ対応**: useColorScheme使用の自動テーマ切り替えシステム
- **統一デザイン**: spacing、typography、colorsの統一
- **レスポンシブ**: KeyboardAvoidingView等のアクセシビリティ対応

### 作成したファイル
- `/packages/frontend/src/features/login/pages/LoginPage.tsx`: メインログインページ
- `/packages/frontend/src/features/login/pages/index.ts`: Pagesエクスポート
- `/packages/frontend/src/features/login/index.ts`: メインエクスポートに追加

### 実装済み機能
- ✅ フォームバリデーション
- ✅ ローディング状態管理
- ✅ 家族選択ダイアログ
- ✅ 親・子ログイン分岐
- ✅ セッション管理（JWT設定）
- ✅ エラー表示
- ✅ ダークテーマ対応

### TODO（次回実装予定）
- 🔄 Supabase認証の実装
- 🔄 React Navigationとの連携
- 🔄 FamilyMemberTypeValueの正しい設定
- 🔄 実際の画面遷移実装
