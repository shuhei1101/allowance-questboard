# 新規登録画面実装計画

## 概要
ログイン画面を参考に、新規登録画面（CreateUserPage）を作成する。
仕様書：`/docs/ja/requirements/feature/認証/新規登録画面/新規登録画面.md`

## 実装タスク

### フロントエンド（既存コンポーネント確認）
- [x] EmailInputFieldEntry
  - 作成場所: `packages/frontend/src/features/shared/components/EmailInputFieldEntry.tsx`
  - 概要: メールアドレス入力エントリーコンポーネント（既存）

- [x] PasswordInputFieldEntry
  - 作成場所: `packages/frontend/src/features/shared/components/PasswordInputFieldEntry.tsx`
  - 概要: パスワード入力エントリーコンポーネント（既存）

- [x] Email値オブジェクト
  - 作成場所: `packages/backend/src/features/auth/value-object/email.ts`
  - 概要: メールアドレスの値オブジェクト（既存）

- [x] Password値オブジェクト
  - 作成場所: `packages/backend/src/features/auth/value-object/password.ts`
  - 概要: パスワードの値オブジェクト（既存）

### フロントエンド（モデル層）
- [x] UserCreateForm
  - 作成場所: `packages/frontend/src/features/auth/create-user-page/models/userCreateForm.ts`
  - 概要: 新規登録フォームのモデルクラス（email: Email, password: Password）
  - 参考: login-page/models/loginForm.ts

### フロントエンド（状態管理層）
- [x] createUserPageStore
  - 作成場所: `packages/frontend/src/features/auth/create-user-page/createUserPageStore.ts`
  - 概要: 新規登録画面の状態管理（Zustand）。userCreateForm、isLoading、emailError、passwordErrorを管理
  - 参考: login-page/loginPageStore.ts

### フロントエンド（ハンドラー層）
- [x] useEmailHandler
  - 作成場所: `packages/frontend/src/features/auth/create-user-page/hooks/useEmailHandler.ts`
  - 概要: メールアドレス入力時のハンドラー
  - 参考: login-page/hooks/useEmailHandler.ts

- [x] usePasswordHandler
  - 作成場所: `packages/frontend/src/features/auth/create-user-page/hooks/usePasswordHandler.ts`
  - 概要: パスワード入力時のハンドラー
  - 参考: login-page/hooks/usePasswordHandler.ts

- [x] useCreateUserHandler
  - 作成場所: `packages/frontend/src/features/auth/create-user-page/hooks/useCreateUserHandler.ts`
  - 概要: 新規登録実行時のハンドラー（確定ボタン押下）。フォーム検証 → supabase auth.signUp → 成功時メール認証画面遷移、失敗時エラー表示
  - 参考: login-page/hooks/useLoginHandler.ts

- [x] createUserPageHandlers
  - 作成場所: `packages/frontend/src/features/auth/create-user-page/hooks/createUserPageHandlers.ts`
  - 概要: ページで使用する全ハンドラーを統合
  - 参考: login-page/hooks/loginPageHandlers.ts

- [x] useUserCreateFormValidationHandler
  - 作成場所: `packages/frontend/src/features/auth/create-user-page/handlers/useUserCreateFormValidationHandler.ts`
  - 概要: 新規登録フォームのバリデーションハンドラー（追加実装）

### フロントエンド（UI層）
- [x] CreateUserPage
  - 作成場所: `packages/frontend/src/features/auth/create-user-page/CreateUserPage.tsx`
  - 概要: 新規登録画面のメインコンポーネント。AppBar（戻るボタン、確定ボタン）、EmailInputFieldEntry、PasswordInputFieldEntryを使用
  - 参考: login-page/LoginPage.tsx

### フロントエンド（ナビゲーション層）
- [x] AuthNavigator更新
  - 作成場所: `packages/frontend/src/features/auth/AuthNavigator.tsx`
  - 概要: 新規登録画面をナビゲーションに追加。CreateUser画面の定義とルート追加

### フロントエンド（多言語対応）
- [x] 日本語メッセージ追加
  - 作成場所: `packages/frontend/src/core/i18n/locales/ja.json`
  - 概要: 新規登録画面用の日本語メッセージを追加（"auth.createUser.title": "新規登録"等）

- [x] 英語メッセージ追加
  - 作成場所: `packages/frontend/src/core/i18n/locales/en.json`
  - 概要: 新規登録画面用の英語メッセージを追加

### フロントエンド（既存画面更新）
- [x] ログイン画面の新規登録ボタン遷移処理追加
  - 作成場所: `packages/frontend/src/features/auth/login-page/hooks/useCreateFamilyHandler.ts`
  - 概要: 新規登録ボタン押下時にCreateUser画面へ遷移する処理を追加（既に実装済み）
  - 参考: 既存のuseCreateFamilyHandler.tsを参考に画面遷移ロジックを更新

### バックエンド（エラーメッセージ）
- [x] AuthErrorMessages更新
  - 作成場所: `packages/backend/src/core/messages/authErrorMessages.ts`
  - 概要: 新規登録用エラーメッセージ（signUpFailed、signUpErrorTitle）を追加

## 実装方針

### アーキテクチャ
- ログイン画面と同じ構造を踏襲
- コーディング規約に準拠（関数型、適切なコメント、SLAP原則）
- レイヤー分離（UI層、ハンドラー層、サービス層）

### 技術スタック
- React Native + TypeScript
- Zustand（状態管理）
- React Navigation（画面遷移）
- Supabase Auth（認証処理）
- i18n（多言語対応）

### 実装順序
1. モデル層（UserCreateForm）
2. 状態管理層（createUserPageStore）
3. ハンドラー層（各種ハンドラー）
4. UI層（CreateUserPage）
5. ナビゲーション更新
6. i18nメッセージ追加

### 注意事項
- ログイン画面の実装パターンを可能な限り踏襲する
- 新機能（メール認証画面遷移）は仕様確認後に実装
- エラーハンドリングはAppErrorを使用
- テストは後工程で実装予定

## 参考ファイル
- `packages/frontend/src/features/auth/login-page/` 配下の全ファイル
- `docs/ja/frontend/ページ.md`
- `docs/ja/common/コーディング規約.md`
