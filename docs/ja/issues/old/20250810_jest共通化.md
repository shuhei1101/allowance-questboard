モノレポだったら、あーし的には**各パッケージごとにJestを入れる必要はないことが多い**よ〜💡✨

ざっくり言うと👇

---

## 🎯 基本ルール

* **Jestはルート（リポジトリ全体のroot）に1つ**でOK
* 各パッケージは、そのルートのJestを使い回す
* 設定ファイル（`jest.config.js`）は**共通設定＋パッケージ別設定**で分けると吉

---

## 🛠 やり方例

```
my-monorepo/
├── package.json   # ← ここに jest を devDependencies でインストール
├── jest.config.js # ← 共通設定（projects使用）
├── jest.config.base.js # ← 基底設定
├── packages/
│   ├── frontend/
│   │   ├── jest.config.js # ← frontend専用設定（共通設定をextend）
│   │   └── src/...
│   └── backend/
│       ├── jest.config.js # ← backend専用設定
│       └── src/...
```

ルートにインストールする例：

```bash
# モノレポのルートで
npm install --save-dev jest @types/jest ts-jest
```

## ✅ 実装完了！

このプロジェクトでは以下の構成で Jest を共通化しました：

### 1. ルートのpackage.json
```json
{
  "devDependencies": {
    "@types/jest": "^30.0.0",
    "jest": "^30.0.5",
    "ts-jest": "^29.4.1"
  },
  "scripts": {
    "test": "jest",
    "test:frontend": "jest --config=jest.config.frontend.js",
    "test:backend": "jest --config=jest.config.backend.js",
    "test:watch": "jest --watch",
    "test:watch:frontend": "jest --watch --config=jest.config.frontend.js",
    "test:watch:backend": "jest --watch --config=jest.config.backend.js",
    "test:coverage": "jest --coverage",
    "test:coverage:frontend": "jest --coverage --config=jest.config.frontend.js",
    "test:coverage:backend": "jest --coverage --config=jest.config.backend.js"
  }
}
```

### 2. Jest設定ファイル構成

**jest.config.js（メイン設定）:**
```js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  projects: [
    '<rootDir>/jest.config.frontend.js',
    '<rootDir>/jest.config.backend.js'
  ],
  collectCoverageFrom: [
    'packages/*/src/**/*.{ts,tsx}',
    '!packages/*/src/**/*.d.ts',
    '!packages/backend/src/main.ts',
    '!packages/frontend/src/index.ts'
  ],
  coverageDirectory: 'coverage',
  coverageReporters: ['text', 'lcov', 'html']
};
```

**jest.config.base.js（共通設定）:**
```js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
  ],
  coverageReporters: ['text', 'lcov', 'html'],
  moduleNameMapper: {
    '^@shared/(.*)$': '<rootDir>/../../shared/$1',
  },
  transform: {
    '^.+\\.tsx?$': ['ts-jest'],
  }
};
```

**jest.config.frontend.js（フロントエンド設定）:**
```js
const baseConfig = require('./jest.config.base');

module.exports = {
  ...baseConfig,
  displayName: 'frontend',
  roots: ['<rootDir>/packages/frontend/src', '<rootDir>/packages/frontend/__tests__'],
  testMatch: [
    '<rootDir>/packages/frontend/**/__tests__/**/*.test.ts',
    '<rootDir>/packages/frontend/**/__tests__/**/*.test.tsx',
    '<rootDir>/packages/frontend/**/?(*.)+(spec|test).ts',
    '<rootDir>/packages/frontend/**/?(*.)+(spec|test).tsx'
  ],
  // ... その他フロントエンド固有の設定
};
```

**jest.config.backend.js（バックエンド設定）:**
```js
const baseConfig = require('./jest.config.base');

module.exports = {
  ...baseConfig,
  displayName: 'backend',
  roots: ['<rootDir>/packages/backend/src', '<rootDir>/packages/backend/__tests__'],
  testMatch: [
    '<rootDir>/packages/backend/**/__tests__/**/*.test.ts',
    '<rootDir>/packages/backend/**/?(*.)+(spec|test).ts'
  ],
  // ... その他バックエンド固有の設定
};
```

### 3. 各パッケージの変更点

- ✅ `packages/frontend/package.json` からjest関連の依存関係を削除
- ✅ `packages/backend/package.json` からjest関連の依存関係を削除

### 4. テスト実行結果

```bash
# 全体テスト実行
npm test
# Test Suites: 10 passed, 10 total
# Tests: 68 passed, 68 total ✅

# フロントエンドのみ
npm run test:frontend
# Test Suites: 1 passed, 1 total
# Tests: 8 passed, 8 total ✅

# バックエンドのみ  
npm run test:backend
# Test Suites: 9 passed, 9 total
# Tests: 60 passed, 60 total ✅
```

---

## 💡 例外的に各パッケージに入れるケース

* そのパッケージだけ**全く別のテストランナーやバージョン**を使いたいとき（例えばVitestとか）
* モノレポじゃない別プロジェクトとして単独配布する予定があって、そこでJestを同梱したいとき

---

## ✨ メリット

1. **依存関係の一元管理**: jest関連のパッケージをルートで一括管理
2. **設定の共通化**: 基底設定を使い回しで重複を削減  
3. **統一されたテスト実行**: 1コマンドで全パッケージのテスト実行
4. **メンテナンス性向上**: バージョン更新が1箇所で済む

完璧にJest共通化完了です〜💕✨
